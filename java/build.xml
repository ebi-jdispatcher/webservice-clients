<!-- Build Java clients for EBI web services. -->
<project name="EBIWS2-Java" basedir="." default="jar">
  <property name="src.dir" value="src" />
  <property name="jdispatcher.src.dir" value="${src.dir}/uk/ac/ebi/webservices/jdispatcher" />
  <property name="build.dir" value="bin" />
  <property name="lib.dir" value="lib"/>

  <!-- Add all jars in lib/ to classpath -->
  <path id="classpath">
    <fileset dir="${lib.dir}" includes="**/*.jar"/>
  </path>

  <!-- Clean-up build directory -->
  <target name="clean">
    <delete includeemptydirs="true">
      <fileset dir="${build.dir}" includes="**/*"/>
    </delete>
  </target>

  <!-- Get back to distributed/repository state -->
  <target name="distclean" depends="clean">
    <delete includeemptydirs="true">
        <fileset dir="${jdispatcher.src.dir}/" includes="ncbiblast"/>
        <!-- <fileset dir="${jdispatcher.src.dir}/ncbiblast"/> -->
        <fileset dir="." includes="${lib.dir}"/>
        <fileset dir="." includes="lib**.zip"/>
    </delete>
  </target>

  <!-- Get dependencies archive, includes Axis 1.4, Axis 2 and JAX-RPC libraries -->
  <target name="get-dependencies">
    <get src="http://www.ebi.ac.uk/Tools/webservices/downloads/java/lib-1.4.zip"
	 dest="lib-1.4.zip" />
  </target>

  <!-- Unpack dependencies archive -->
  <target name="unpack-dependencies" depends="get-dependencies">
    <unzip src="lib-1.4.zip" dest="." />
  </target>

  <!-- Generate stubs from a WSDL -->
  <target name="genStubs">
    <echo message="${stubPkg}" />
    <echo message="${wsdlUrl}" />
    <java classname="org.apache.axis.wsdl.WSDL2Java"
	  classpathref="classpath"
	  fork="yes"
	  dir="${src.dir}">
      <arg value="-p" />
      <arg value="${stubPkg}" />
      <arg value="${wsdlUrl}" />
    </java>
  </target>

  <!-- Generate stubs for all services -->
  <target name="stubs-all" depends="unpack-dependencies">
    <!-- <antcall target="stubs-clustalw2-msa" /> -->
  	<!-- <antcall target="stubs-clustalw2-phylotree" /> -->
    <antcall target="stubs-fasta" />
    <antcall target="stubs-ncbiblast" />
    <antcall target="stubs-wublast" />
  </target>

  <!-- Generate stubs for each service -->
	  <target name="stubs-clustalw2-msa">
	    <antcall target="genStubs">
	      <param name="stubPkg" value="uk.ac.ebi.webservices.jdispatcher.clustalw2.msa" />
	      <param name="wsdlUrl" value="http://wwwdev.ebi.ac.uk/Tools/jdispatcher/services/soap/clustalw2-msa?wsdl" />
	    </antcall>
	  </target>
	  <target name="stubs-clustalw2-phylotree">
	    <antcall target="genStubs">
	      <param name="stubPkg" value="uk.ac.ebi.webservices.jdispatcher.clustalw2.phylotree" />
	      <param name="wsdlUrl" value="http://wwwdev.ebi.ac.uk/Tools/jdispatcher/services/soap/clustalw2-phylotree?wsdl" />
	    </antcall>
	  </target>
	  <target name="stubs-fasta">
	    <antcall target="genStubs">
	      <param name="stubPkg" value="uk.ac.ebi.webservices.jdispatcher.fasta" />
	      <param name="wsdlUrl" value="http://wwwdev.ebi.ac.uk/Tools/jdispatcher/services/soap/fasta?wsdl" />
	    </antcall>
	  </target>
	  <target name="stubs-ncbiblast">
	    <antcall target="genStubs">
	      <param name="stubPkg" value="uk.ac.ebi.webservices.jdispatcher.ncbiblast" />
	      <param name="wsdlUrl" value="http://wwwdev.ebi.ac.uk/Tools/jdispatcher/services/soap/ncbiblast?wsdl" />
	    </antcall>
	  </target>
	  <target name="stubs-wublast">
	    <antcall target="genStubs">
	      <param name="stubPkg" value="uk.ac.ebi.webservices.jdispatcher.wublast" />
	      <param name="wsdlUrl" value="http://wwwdev.ebi.ac.uk/Tools/jdispatcher/services/soap/wublast?wsdl" />
	    </antcall>
	  </target>

  <!-- Compile code into classes -->
  <target name="compile">
    <javac
      srcdir="${src.dir}"
      destdir="${build.dir}"
      classpathref="classpath"
    />
  </target>

  <!-- Package jars -->
  <target name="jar" depends="compile">
    <!-- <jar destfile="${build.dir}/ClustalW2.jar"
	 basedir="${build.dir}"
	 includes="uk/ac/ebi/webservices/jdispatcher/ClustalW2Client.** uk/ac/ebi/webservices/jdispatcher/clustalw2/**">
     <manifest>
       <attribute name="Main-Class" value="uk.ac.ebi.webservices.jdispatcher.ClustalW2Client"/>
     </manifest>
   </jar> -->
    <jar destfile="${build.dir}/Fasta.jar"
	 basedir="${build.dir}"
	 includes="uk/ac/ebi/webservices/jdispatcher/FastaClient.** uk/ac/ebi/webservices/jdispatcher/AbstractWsClient.** uk/ac/ebi/webservices/jdispatcher/fasta/**">
     <manifest>
       <attribute name="Main-Class" value="uk.ac.ebi.webservices.jdispatcher.FastaClient"/>
     </manifest>
   </jar>
    <jar destfile="${build.dir}/NCBIBlast.jar"
	 basedir="${build.dir}"
	 includes="uk/ac/ebi/webservices/jdispatcher/NCBIBlastClient.** uk/ac/ebi/webservices/jdispatcher/AbstractWsClient.** uk/ac/ebi/webservices/jdispatcher/ncbiblast/**">
     <manifest>
       <attribute name="Main-Class" value="uk.ac.ebi.webservices.jdispatcher.NCBIBlastClient"/>
     </manifest>
   </jar>
    <jar destfile="${build.dir}/WUBlast.jar"
	 basedir="${build.dir}"
	 includes="uk/ac/ebi/webservices/jdispatcher/WUBlastClient.** uk/ac/ebi/webservices/jdispatcher/AbstractWsClient.** uk/ac/ebi/webservices/jdispatcher/wublast/**">
     <manifest>
       <attribute name="Main-Class" value="uk.ac.ebi.webservices.jdispatcher.WUBlastClient"/>
     </manifest>
   </jar>
  </target>

	<!-- Test clients -->
	<target name="test" depends="jar">
	    <ant dir="test" inheritAll="false" />
	</target>
</project>
